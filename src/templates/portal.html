{% extends "main.html" %}
{% include "smartapi-head.html" %}
{% block content %}
{% include "header.html" %}
<main id="portals" class="white" v-cloak>
  <!-- MAIN SECTIONS -->
  <section class="center grey lighten-3 d-flex justify-content-around flex-wrap">
    <div v-if="name == 'translator'" class="row">
      <div class="col s12 m4 padding20">
        <img src="/static/img/TranslatorLogo.JPG" aria-label="NCATS" height="77px"/>
      </div>
      <div class="col s12 m4 padding20">
        <h1 class="blue-text bold flow-text">
          <span v-if="name == 'translator'">
            A SmartAPI Portal for NCATS Biomedical Data Translator
          </span>
          <span v-else v-text="name"></span>
        </h1>
        <p class="blue-grey-text" v-if="name == 'translator'">
          This program focuses on building tools for massive knowledge integration in support of biomedical and translational science. <a target="_blank" rel="noreferrer" href="https://ncats.nih.gov/translator">Learn more</a>
        </p>
      </div>
      <div class="col s12 m4 padding20">
        <img src="/static/img/ncats-logo-1.png" aria-label="NCATS" height="77px"/>
      </div>
      <div class="col s12 padding20 center-align grey lighten-2">
        <p>View a summary of all the APIs used by this portal.</p>
        <a href="/portal/translator/summary" class="btn blue">Portal Summary</a>
      </div>
    </div>
    <div v-else>
      <h1 class="blue-text bold flow-text">
        <span v-text="name"></span>
      </h1>
    </div>
  </section>



  <template v-if="name == 'translator'">
    <main id="portal">
      <div class="d-flex align-items-stretch row flex-wrap m-0">
        <!-- Left -->
        <div class="col s12 m6 padding20">
          <h3 class="center blue-text bold">BUILD A TRANSLATOR KNOWLEDGE PROVIDER API</h3>
          <section>
            <div class="d-flex">
              <h5 class="meta_grad" style="margin-right:5px;padding:2px;"></h5>
              <h5 class="meta_grad" style="margin-right:5px;padding:4px;"></h5>
              <h5 class="white-text meta_grad rounded-right padding20"><i class="material-icons">filter_1</i> Create a Knowledge Provider API</h5>
            </div>
            <p class="center">
              <img src="/static/img/build_api-01.svg" width="100px" alt="create api"/>
            </p>
            <p>
              To create a Knowledge Provider (KP) API that's ready to be integrated into the Translator ecosystem, you can:
              <ul>
                <li>
                  <i class="material-icons green-text">done</i> Build a REST API with JSON output (use your own preferred structure).
                </li>
                <li>
                  <i class="material-icons green-text">done</i> Build a ReasonerStdAPI, follow the instructions <a target="_blank" rel="noreferrer" href="https://github.com/NCATS-Tangerine/NCATS-ReasonerStdAPI">here <i class="fa fa-external-link-square" aria-hidden="true"></i></a>.
                </li>
              </ul>
              Regardless the type of APIs you are implementing, we recommend to follow these <a class="modal-trigger green-text" href="#modal" @click="handleModal('best-practices')">API best-practices</a>.
            </p>
            <p>
              <b>Tip: </b>You may consider using <a href="https://docs.biothings.io/en/latest/" target="_blank" rel="noreferrer">BioThings SDK <i class="fa fa-external-link-square" aria-hidden="true"></i></a> to build your KP APIs. BioThings SDK will create a high-quality APIs following all these best-practices by default. If you need the help, please <a href="mailto:biothings@googlegroups.com">contact</a> BioThings team (aka "Service Provider" KP team in Translator).
            </p>
          </section>
          <section>
            <div class=" d-flex">
              <h5 class="meta_grad" style="margin-right:5px;padding:2px;"></h5>
              <h5 class="meta_grad" style="margin-right:5px;padding:4px;"></h5>
              <h5 class="white-text meta_grad rounded-right padding20"><i class="material-icons">filter_2</i> Document your API with metadata</h5>
            </div>
            <p class="center">
              <img src="/static/img/navigate_api-01.svg" width="100px" alt="document api"/>
            </p>
            <p>
              To take full advantage of SmartAPI and make your KP API compatible with Meta-KG you will need to:
            </p>
            <ul>
              <li>
                <i class="material-icons green-text">done</i> Create your API metadata following the latest <a href="http://spec.openapis.org/oas/v3.0.3" target="_blank" rel="noreferrer">OpenAPI v3 API specification <i class="fa fa-external-link-square" aria-hidden="true"></i></a>
              </li>
              <li>
                <i class="material-icons green-text">done</i> Add semantics of your API's inputs and outputs using the SmartAPI extensions. <a class="modal-trigger green-text" href="#modal" @click="handleModal('sematic-io')">Learn more</a>.
              </li>
            </ul>
            <p>
              You can use this <a href="/editor">editor</a> build to write/edit your API metadata. You can start with an existing metadata example from <a target="_blank" rel="noreferrer" href="https://github.com/NCATS-Tangerine/translator-api-registry/blob/master/mygene.info/openapi_minimum.yml">mygene.info</a> API. The editor automatically validates your API metadata and gives a live preview of auto-generated API documentation.
            </p>
            <p>
              This guide can also <a href="/guide">guide</a> through the process/tools on how to create your OpenAPI v3 API metadata or how to upgrade an existing Swagger v2 API metadata to OpenAPI v3.
            </p>
  
          </section>
          <section>
            <div class=" d-flex">
              <h5 class="meta_grad" style="margin-right:5px;padding:2px;"></h5>
              <h5 class="meta_grad" style="margin-right:5px;padding:4px;"></h5>
              <h5 class="white-text meta_grad rounded-right padding20"><i class="material-icons">filter_3</i> Register your API</h5>
            </div>
            <p>
              Once you are ready and <a href="/add_api">register</a> your KP API it will be listed on the <a href="/registry/translator">SmartAPI registy</a> and
              your API will be visible to other users. Eg. <a href="/registry?q=59dce17363dce279d389100834e43648">MyGene.info API</a>
            </p>
            <p>
              The registry provides useful information and operation documentation, API status, editing tools and many other neat features!
            </p>
            <div class="center">
              <img alt="registry pluses" src="/static/img/registry_plus-01.png" width="90%"/>
            </div>
            <div class="center">
              <a class="btn blue btn-large" href="/registry/translator">Registry</a>
            </div>
          </section>
        </div>
        <!-- Right -->
        <div class="col s12 m6 padding20 meta_grad white-text container">
          <div class="center">
            <h3 class="center cyan-text bold">EXPLORE THE TRANSLATOR API META KNOWLEDGE GRAPH</h3>
            <img src="/static/img/metakg-01.png" aria-label="NCATS" width="150px"/>
            <h1>META-KG</h1>
            <p class="center">
              <a class="btn green btn-large" href="/portal/translator/metakg">Try it</a>
            </p>
          </div>
          <p>
            The SmartAPI Meta Knowledge Graph (Meta-KG) represents how biomedical concepts can be connected through APIs. Each node in the meta-KG represents a biolink entity type, e.g. Gene, SequenceVariant, ChemicalSubstance. Each edge in the meta-KG represents a unique combination of a biolink predicate, e.g. targets, treats, and an API which delivers the association.
          </p>
          <div class="center">
            <img src="/static/img/metaex.png" width="200px" alt="query example"/>
            <hr />
            <small>Disease affets Gene</small>
          </div>
          <p>
            The Meta-KG is constructed using the collection of SmartAPI specifications currently registered in SmartAPI. All APIs registered with <a href="https://x-bte-extension.readthedocs.io/" target="_blank" rel="nonreferrer">x-bte <i class="fa fa-external-link" aria-hidden="true"></i></a> field will be integrated into the meta-KG. In addition, all ReasonerStdAPIs registered in SmartAPI and implemented the /predicate endpoint will also be integrated.
          </p>
          <h5 class="bold center">What can you do with Meta-KG?</h5>
          <p>Traverse a complex network of connected KP APIS and search APIs based on meta-kg operations (API endpoints that fetch results given a desired output, input, predicate or any combination of them ).</p>
          <h4 class="cyan-text center">Example</h4>
          <div class="white grey-text rounded center p-1">
            <p>
              Find APIs that report entities that <b>AFFECT</b> <b>GENES</b>...
            </p>
          </div>
          <p>
            Meta-KG would then find all connections with <i>predicate</i> “affects” and <i>output_type</i> “Gene” and give you a list of APIs which can give you that type of results.
            <a href="/portal/translator/metakg?predicate=affects&output_type=Gene">View example</a>
          </p>
          <img src="/static/img/graph_example.jpg" width="100%" alt="graph example" class="rounded"/>
          <p class="center">
            <a class="btn green btn-large" href="/portal/translator/metakg">Try it</a>
          </p>
        </div>
      </div>
  
      <!-- Modal Structure -->
      <div id="modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <a href="#!" class="modal-close btn-flat grey">Close</a>
            <a class="right" :href="editLink" target="_blank" rel="noreferrer">
              <small><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit These Docs</small>
            </a>
          </div>
          <div id="desc"></div>
          <div class="modal-footer">
            <a href="#!" class="modal-close btn-flat grey">Close</a>
          </div>
  
        </div>
  
      </div>
    </main>
  </template>

</main>

{% include "footer.html" %}
{% endblock %}
{% block extra_scripts %}
  <script src="https://unpkg.com/vuex"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/@biothings-explorer/smartapi-kg@1.0.16/bundle.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.15.1/cytoscape.min.js" integrity="sha256-oYPiLQ2sL4jlYuCJE3rDZFD0OUy8t1fL6U0wIWyqUf8=" crossorigin="anonymous"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/remarkable/1.7.1/remarkable.js"></script>
  <script>

  const store = new Vuex.Store({
      state: {
        'name': Object,
      },
      strict: true,
      mutations: {
        saveContext(state,payload){
          state.name= payload['context']['portal'];
        },

      },
      getters:{
        getName:(state)=>{
          return state.name
        },
      },
      actions:{

      }
    });


  var app = new Vue({
      el: '#portals',
      data: function(){
        return {
          editLink:''
        }
      },
      computed: {
        name : function(){
          return store.getters.getName
        },
      },
      watch:{

      },
      methods: {
        compiledMarkdown: function (mdtext,url) {
          if (url){
            fetch(mdtext)
            .then(response => response.text())
            .then(function(result){
              return marked(result, { sanitize: true })
            })
          }else{
            return marked(mdtext, { sanitize: true })
          }
        },
        convertMarkdownToHtml: function(url,target){
            var targetDump = document.getElementById(target);
            if (targetDump.innerHTML) {
              targetDump.innerHTML = "";
              targetDump.classList.remove('white');
            }else{
              targetDump.classList.add('white');
              // covert markdown from raw data url to html, and dump html in target
              axios.get(url).then(response=>{

                  var md = new Remarkable({
                    html:         true,        // Enable HTML tags in source
                    xhtmlOut:     false,        // Use '/' to close single tags (<br />)
                    breaks:       false,        // Convert '\n' in paragraphs into <br>
                    langPrefix:   'language-',  // CSS language prefix for fenced blocks
                    linkify:      true,        // Autoconvert URL-like text to links

                    // Enable some language-neutral replacement + quotes beautification
                    typographer:  false,

                    // Double + single quotes replacement pairs, when typographer enabled,
                    // and smartquotes on. Set doubles to '«»' for Russian, '„“' for German.
                    quotes: '“”‘’',

                    // Highlighter function. Should return escaped HTML,
                    // or '' if the source string is not changed
                    highlight: function (/*str, lang*/) { return ''; }
                  });
                  var targetDump = document.getElementById(target);
                  var html = md.render(response.data);
                  targetDump.innerHTML = html;

              }).catch(err=>{
                  throw err;
              });
            }
        },
        handleModal(anchor){
          var self = this;

          var targetDump = document.getElementById('desc');
          targetDump.innerHTML = "";

          switch (anchor) {
            case 'best-practices':
                self.convertMarkdownToHtml('https://raw.githubusercontent.com/SmartAPI/smartAPI/master/docs/CREATE_API.md','desc')
                self.editLink ='https://github.com/SmartAPI/smartAPI/edit/master/docs/CREATE_API.md'
              break;
            case 'sematic-io':
              self.convertMarkdownToHtml('https://raw.githubusercontent.com/SmartAPI/smartAPI/master/docs/API_METADATA.md','desc')
              self.editLink ='https://github.com/SmartAPI/smartAPI/edit/master/docs/API_METADATA.md'
              break;
            default:
              console.log('no match')
          }

        }
      },
      created: function(){
        if ({{Context}}) {
          // console.log({{Context}})
          var payload = {};
          payload["context"] = {{Context}};
          store.commit('saveContext',payload);
        }

      },mounted:function(){
        var self = this;
      }
  });
  </script>
{% endblock %}
